"use strict";class MetingJSElement extends HTMLElement{connectedCallback(){window.AlicePlayer&&window.fetch&&(this._init(),this._parse())}disconnectedCallback(){!this.lock}_camelize(a){return a.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(a,b)=>b.toUpperCase())}_init(){for(var a={},b=0;b<this.attributes.length;b+=1)a[this._camelize(this.attributes[b].name)]=this.attributes[b].value;var c=["server","type","id","api","auth","auto","lock","name","title","artist","author","url","cover","pic","lyric","lrc"];this.meta={};for(var d,e=0,f=c;e<f.length;e++)d=f[e],this.meta[d]=a[d],delete a[d];// window.meting_api = 'https://api.2heng.xin/meting/api.php?server=:server&type=:type&id=:id&auth=:auth&r=:r';
this.config=a,window.meting_api="https://service-nkw594cl-1253826990.cd.apigw.tencentcs.com/release/meting?server=:server&type=:type&id=:id&auth=:auth&r=:r",this.api=this.meta.api||window.meting_api||"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r",this.meta.auto&&this._parse_link()}_parse_link(){for(var a=[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+).html","tencent","song"],["y.qq.com.*album/(\\w+).html","tencent","album"],["y.qq.com.*singer/(\\w+).html","tencent","artist"],["y.qq.com.*playsquare/(\\w+).html","tencent","playlist"],["y.qq.com.*playlist/(\\w+).html","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]],b=0,c=a;b<c.length;b++){var d=c[b],e=new RegExp(d[0]),f=e.exec(this.meta.auto);if(null!==f)return this.meta.server=d[1],this.meta.type=d[2],void(this.meta.id=f[1])}}_parse(){if(this.meta.url){var b={name:this.meta.name||this.meta.title||"Audio name",artist:this.meta.artist||this.meta.author||"Audio artist",url:this.meta.url,cover:this.meta.cover||this.meta.pic,lrc:this.meta.lrc||this.meta.lyric||"",type:this.meta.type||"auto"};return b.lrc||(this.meta.lrcType=0),this.innerText&&(b.lrc=this.innerText,this.meta.lrcType=2),void this._loadPlayer([b])}var a=this.api.replace(":server",this.meta.server).replace(":type",this.meta.type).replace(":id",this.meta.id).replace(":auth",this.meta.auth).replace(":r",Math.random());fetch(a).then(a=>a.json()).then(a=>this._loadPlayer(a))}_loadPlayer(a){// console.log(data);
var b=a.map(function(a){return a.pic="https://ip.webmasterapi.com/api/imageproxy/"+a.pic,a.audio=a.url,a}),c=document.createElement("div");// let defaultOption = {
//   audio: data,
//   mutex: true,
//   lrcType: this.meta.lrcType || 3,
//   storageName: 'metingjs'
// }
// if (!data.length) return
// let options = {
//   ...defaultOption,
//   ...this.config,
// }
// for (let optkey in options) {
//   if (options[optkey] === 'true' || options[optkey] === 'false') {
//     options[optkey] = (options[optkey] === 'true')
//   }
// }
// options.container = div
this.appendChild(c),this.ap=new AlicePlayer(b,{container:c})}}// console.log('\n %c MetingJS v2.0.1 %c https://github.com/metowolf/MetingJS \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
window.customElements&&!window.customElements.get("meting-js")&&(window.MetingJSElement=MetingJSElement,window.customElements.define("meting-js",MetingJSElement));
